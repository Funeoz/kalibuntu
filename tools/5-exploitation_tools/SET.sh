#! /usr/bin/env bash

install_SET () {
    start_spinner 'Installing SET'
    cd ../.. || exit
    cd binaries || exit
    git clone https://github.com/trustedsec/social-engineer-toolkit/ setoolkit/ >> ../kalibuntu.log 2>&1
    su - "$DEFAULT_USER" -c "pip3 install -r -y kalibuntu/binaries/social-engineer-toolkit/requirements.txt >> kalibuntu/kalibuntu.log"
    cd .. || exit
    cd tools/5-exploitation-tools || exit
    stop_spinner $?
    echo " "
    echo "Installation finished"
    echo "You can run SET by executing kalibuntu/binaries/social-engineer-toolkit/setoolkit"
    return
}

uninstall_SET () {
    start_spinner 'Uninstalling SET'
    su - "$DEFAULT_USER" -c "pip3 uninstall -r -y kalibuntu/binaries/social-engineer-toolkit/requirements.txt >> kalibuntu/kalibuntu.log"
    cd ../.. || exit
    cd binaries || exit
    rm -rf social-engineer-toolkit
    stop_spinner $?
    echo " "
    echo "Uninstallation finished"
    return
}

update_SET () {
    start_spinner 'Updating SET'
    cd ../.. || exit
    cd binaries/social-engineer-toolkit || exit
    git pull 
    cd ../.. || exit
    cd tools/5-social-engineer-toolkit || exit
    stop_spinner $?
    echo " "
    echo "Update finished"
    return
}

return_to_install_script-5 () {
    clear
    ./install_script-5.sh
    return
}

main () {
    clear
    source ../../spinner.sh
    . banner.sh
    tput bold
    echo "Install/Uninstall/Update SET ?"
    tput sgr0
    echo " "

    select choice in Install Uninstall Update back; do
        case $choice in 
        Install)
            install_SET
            break
            ;;
        Uninstall)
            uninstall_SET
            break
            ;;
        Update)
            update_SET
            break
            ;;
        back)
            return_to_install_script-5
            break
            ;;
        *)
            clear
            main
            break
            ;;
        esac
    done
    return
}

main