#! /usr/bin/env bash

install_routersploit () {
    start_spinner 'Installing routersploit'
    apt-get install libglib2.0-dev -y >> ../../kalibuntu.log
    su - "$DEFAULT_USER" -c "{
    cd kalibuntu/binaries && \
    git clone https://www.github.com/threat9/routersploit && \
    cd routersploit && \
    python3 -m pip install setuptools && \
    python3 -m pip install bluepy && \
    python3 -m pip install -r requirements.txt && \
    cd
    } >> kalibuntu/kalibuntu.log"
    stop_spinner $?
    echo " "
    echo "Installation finished"
    echo "You can run routersploit by executing kalibuntu/binaries/routersploit/rsf.py"
    return
}

uninstall_routersploit () {
    start_spinner 'Uninstalling routersploit'
    apt-get purge libglib2.0-dev -y >> ../../kalibuntu.log
    su - "$DEFAULT_USER" -c "{
    pip3 uninstall kalibuntu/binaries/metasploit/requirements.txt setuptools bluepy -y && \
    rm -rf kalibuntu/binaries/routersploit
    } >> kalibuntu/kalibuntu.log 2>&1"
    stop_spinner $?
    echo " "
    echo "Uninstallation finished"
    return
}

update_routersploit () {
    start_spinner 'Updating routersploit'
    su - "$DEFAULT_USER" -c "cd kalibuntu/binaries/routersploit && git pull"
    stop_spinner $?
    echo " "
    echo "Update finished"
    return
}

return_to_install_script-5 () {
    clear
    ./install_script-5.sh
    return
}

main () {
    clear
    source ../../spinner.sh
    . banner.sh
    tput bold
    echo "Install/Uninstall/Update routersploit ?"
    tput sgr0
    echo " "

    select choice in Install Uninstall Update back; do
        case $choice in 
        Install)
            install_routersploit
            break
            ;;
        Uninstall)
            uninstall_routersploit
            break
            ;;
        Update)
            update_routersploit
            break
            ;;
        back)
            return_to_install_script-5
            break
            ;;
        *)
            clear
            main
            break
            ;;
        esac
    done
    return
}

main